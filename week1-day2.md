# Day 2

## Setting up Master-Slave DNS Server using bind tools

Master DNS servers are the original zone handlers and slave DNS servers are just backup servers which is used to copy the zone information from master DNS server. Mas.Serv. will resolve the names for every hosts which is defined in the zone db and use UDP protocol (no acknowledgement process while tcp does).

### In Master machine

in /etc/named.conf

```shell
options {
    listen-on port 53 { any; };
    directory       "/var/named";
    dump-file       "/var/named/data/cache_dump.db";
    statistics-file "/var/named/data/named_stats.txt";
    memstatistics-file "/var/named/data/named_mem_stats.txt";
    secroots-file   "/var/named/data/named.secroots";
    recursing-file  "/var/named/data/named.recursing";
    allow-query     { any; };
    allow-transfer  { localhost; 192.168.2.129; };
    recursion yes;
};
zone "." IN {
type hint;
file "named.ca";
};

#forward zone
zone "testlocal.com" IN {
        type master;
        file "/var/named/testlocal.fwd.zone";
        allow-update { none; };
};

#backward zone
zone "2.168.192.in-addr.arpa" IN {
        type master;
        file "/var/named/testlocal.rev.zone";
        allow-update { none; };
};
```

in /var/named/testlocal.fwd.zone

```shell
$TTL 86400
@       IN SOA  masterdns.testlocal.com.     root.testlocal.com. (
                                2014090401    ; serial
                                        3600    ; refresh
                                        1800    ; retry
                                    604800    ; expire
                                    86400 )  ; minimum

; Name server\'s

@       IN      NS      masterdns.testlocal.com.
@       IN      NS      slavedns.testlocal.com.

; Name server hostname to IP resolve.

@       IN      A       192.168.2.128
@       IN      A       192.168.2.129

; Hosts in this Domain

@       IN      A       192.168.2.210
@       IN      A       192.168.2.220
masterdns       IN      A       192.168.2.128
slavedns        IN      A       192.168.2.129
node1           IN      A       192.168.2.210
rhel1           IN      A       192.168.2.220
```

in /var/named/testlocal.rev.zone

```shell
$TTL 86400
@       IN SOA  masterdns.testlocal.com. root.testlocal.com. (
                                2014090402      ; serial
                                    3600      ; refresh
                                    1800      ; retry
                                    604800      ; expire
                                    86400 )    ; minimum

; Name server\'s

@       IN      NS      masterdns.testlocal.com.
@       IN      NS      slavedns.testlocal.com.
@       IN      PTR     testlocal.com.
; Name server hostname to IP resolve.

masterdns       IN      A       192.168.2.128
slavedns        IN      A       192.168.2.129
;Hosts in Domain 

node1           IN      A       192.168.2.210
rhel            IN      A       192.168.2.220
128             IN      PTR     masterdns.testlocal.com.
129             IN      PTR     slavedns.testlocal.com.
210             IN      PTR     node1.testlocal.com.
220             IN      PTR     rhel1.testlocal.com.
```

Here we can see both the files are in root users ownership, because files which we makes a copy from sample files are available under /var/named/. Change the group to named on both files using following commands.

```bash
sudo ls -l /var/named/
sudo chgrp named /var/named/testlocal.fwd.zone
sudo chgrp named /var/named/testlocal.rev.zone
```

Check for errors

```bash
sudo named-checkconf /etc/named.conf
sudo named-checkzone masterdns.testlocal.com /var/named/testlocal.fwd.zone
sudo named-checkzone masterdns.testlocal.com /var/named/testlocal.rev.zone
```

In /etc/resolv.conf

```shell
# Generated by NetworkManager
search localdomain testlocal.com
nameserver 192.168.2.128 #master DNS ip address
```

Change firewall settings and restart the firewall

```bash
sudo firewall-cmd --permanent --zone=public --add-service=dns
sudo firewall-cmd --permanent --zone=public --add-service=dns-tcp
sudo firewall-cmd --reload
```

Or

```bash
sudo iptables -I INPUT -p udp --dport 53 -m state --state NEW -j ACCEPT
#Now, verify that the rules has been added correctly in INPUT chain.

sudo iptables -L INPUT
#Next, save the rules and restart firewall.

sudo service iptables save
sudo service iptables restart
```

Test the DNS zones with nslookup or dig

```bash
nslookup testlocal.com
nslookup masterdns.testlocal.com
nslookup slavedns.testlocal.com
```

## In Slave machine

in /etc/named.conf

```shell
options {
        listen-on port 53 { any; };
        listen-on-v6 port 53 { ::1; };
        directory       "/var/named";
        dump-file       "/var/named/data/cache_dump.db";
        statistics-file "/var/named/data/named_stats.txt";
        memstatistics-file "/var/named/data/named_mem_stats.txt";
        secroots-file   "/var/named/data/named.secroots";
        recursing-file  "/var/named/data/named.recursing";
        allow-query     { localhost; 192.168.2.0/24; };
        recursion yes;
};
zone "." IN {
        type hint;
        file "named.ca";
};

zone"testlocal.com" IN {
type slave;
file "slaves/testlocal.fwd.zone";
masters { 192.168.2.128; };
};

zone"2.168.192.in-addr.arpa" IN {
type slave;
file "slaves/testlocal.rev.zone";
masters { 192.168.2.128; };
};
```

Restart the named service and check if the slave copied and updated the zone files

```bash
sudo cat /var/named/slaves/testlocal.fwd.zone
sudo cat /var/named/slaves/testlocal.rev.zone
```

In /etc/resolv.conf

```shell
# Generated by NetworkManager
search localdomain testlocal.com
nameserver 192.168.2.128 #master DNS ip address
nameserver 192.168.2.129 #slave DNS ip address
```

Update the firewall settings

```bash
sudo iptables -I INPUT -p udp --dport 53 -m state --state NEW -j ACCEPT
#Save the iptables rules and restart the iptables service.
sudo service iptables save
sudo service iptables restart
```

Or

```bash
sudo firewall-cmd --permanent --zone=public --add-service=dns
sudo firewall-cmd --permanent --zone=public --add-service=dns-tcp
sudo firewall-cmd --reload
```

Restart the firewall

### In client machine

Change the /etc/resolv.conf file with new nameserver ip address

```shell
nameserver 192.168.2.128
nameserver 192.168.2.129
options edns0 trust-ad
search .
```

Finally test the DNS zones with nslookup or dig

```bash
dig masterdns.tecmintlocal.com
dig -x 192.168.2.128
dig -x 192.168.2.129
dig node1.tecmintlocal.com
ping masterdns.tecmintlocal.com -c 2
ping slavedns.tecmintlocal.com -c 2
ping 192.168.0.200 -c 2
ping 192.168.0.201 -c 2
```

### References

[tecmint - Setup Master-Slave DNS Server in CentOS](https://www.tecmint.com/setup-master-slave-dns-server-in-centos/)

## Setting up DHCP server and client in two VM running Rocky linux

[Refrence Tecmint article](https://www.tecmint.com/install-dhcp-server-client-on-centos-ubuntu/)

## Networking for Hackers by Khit Min Nyo

LAN - Local Area Network
MAN - Metropolitan Area Network
WAN - Wide Area Network

### Two types of Internet Protocol (IP) addresses

1. Public and Private IP addresses (Based on nature of them)
2. Dynamic and Static IP addresses (Based on characteristics of them)

#### Public and Private IP addresses

* Public - Unique and can be conneted from any devices with an internet connection on the world
* Private - same network only connectable IP addresses (same wifi)

#### Dynamic and Static IP addresses

* Dynamic - always changing IP addresses assigned by DHCP server (e.g. using phone with mobile data and checking the public ip address and then turn off data, turn it on again and checking the ip addr again)
* Static - used in server address, also used in my wifi network (e.g. google.com ip addr by DNS)

### IP ranges

1. IPv4
2. IPv6

#### IPv4

* 4x8bits = 32 bits (4 bytes)
* has 5 classes (A, B, C, D, E)
* mostly used class A, B, C
* Class A IP ranges - only first octet is for network id, last 3 octet is for host id, Network id is from 1-127 but 127 is reserved for loopback address so it only has 126 network. (0.0.0.0 - 127.255.255.255) has max host number of 2 power 24 - 2. Default Subnet mask is 255.0.0.0. why subtract 2? - because the starting addr and ending addr are network addr and broadcast addr (e.g. 127.0.0.0 and 127.255.255.255)
* Class B IP ranges - first 2 octet is for network id, last 2 octet is for host id, Network id is from 128 to 191, has 16382 network. (128.0.0.0 - 191.255.0.0) has max host number of 2 power 16 - 2. Default Subnet mask is 255.255.0.0.
* Class C IP ranges - first 3 octet is for network id, last 1 octet is for host id, Network id is from 192 to 223, has over 2 million network. (192.168.0.0 - 223.255.255.0) has max host number of 2 power 8 - 2. Default Subnet mask is 255.255.255.0
* Class D IP ranges - Class D is for multicast (one to many at the same time), used in audio, video streaming, gaming, etc. can work on different networks. Range is 224.0.0.0 239.255.255.255 (no network id counts or host counts) - group communication across different networks.
* Class E IP Ranges - for research purpose only, 240.0.0.0 to 255.255.255.255
